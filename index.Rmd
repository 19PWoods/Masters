---
title: "Woods Master's Thesis"
output: 
  flexdashboard::flex_dashboard:
    orientation: columns
    vertical_layout: fill
---

```{r setup, include=FALSE}

# Script Setup --------------------
library(tidyverse)
library(flexdashboard)
library(readxl)
library(ggpubr)
library(plotly)
library(reactable)
theme_set(theme_classic())

setwd("C:/Users/pcw00/Dropbox/University of Massachusetts Amherst/Thesis- Stretch Activation/Data/Woods - Master's Thesis/Project/Tension + AaBbCc") # nolint

# Data Read in --------------------
my_data_raw <- read_excel("SA-Fatigue_Tension+Step+Kinetics_PW_5-19-23.xlsx",
                          sheet = "Manuscript.2",
                          skip = 5,
                          na = "") %>%
  filter(Exp_Con_Num %in% c(2:4))

my_data_means <- read_excel("Woods_EMM_7-18-23.xlsx",
                            sheet = "EMM.2")


### Stretch Activation Tab--------------------------------------
f0_gg <- my_data_means %>%
  filter(Value == "F0") %>%
  ggplot(aes(Exp_Con,
             EMM,
             group = fiber_type_num)) +
  geom_bar(aes(fill = fiber_type),
           stat = "identity",
           position = position_dodge()) +
  geom_point(data = my_data_raw,
             aes(x = Exp_Con,
                 y = Po_Pre_Step,
                 text = paste("Filename", Filename),
                 shape = Muscle),
             position = position_dodge(width = 0.9)) +
  geom_errorbar(aes(ymin = EMM - SE,
                    ymax = EMM + SE),
                position = position_dodge(width = 0.9),
                width = 0.3,
                size = 2) +
  scale_y_continuous(limits = c(0, 350)) +
  ylab("Calcium-activated Specific Tension (mN/mm^2)") +
  guides(fill=guide_legend(title = "Fiber Types")) +
  theme(axis.title.y = element_text(size = 18),
        axis.title.x = element_blank(),
        axis.text = element_text(size = 15),
        legend.title = element_text(size = 15),
        legend.text = element_text(size = 15),
        legend.key.size = unit(1, "cm")) +
  scale_fill_manual(breaks = c("I",
                               "IIA",
                               "IIX",
                               "IIB"),
                    values = c("#E69F00",
                               "#56B4E9",
                               "#CC79A7",
                               "#009E73"))


fsa_gg <- my_data_means %>%
  filter(Value == "Fsa") %>%
  ggplot(aes(Exp_Con,
             EMM,
             group = fiber_type_num)) +
  geom_bar(aes(fill = fiber_type),
           stat = "identity",
           position = position_dodge()) +
  geom_point(data = my_data_raw,
             aes(x = Exp_Con,
                 y = Fsa,
                 text = paste("Filename", Filename),
                 shape = Muscle),
             position = position_dodge(width = 0.9)) +
  geom_errorbar(aes(ymin = EMM - SE,
                    ymax = EMM + SE),
                position = position_dodge(width = 0.9),
                width = 0.15,
                size = 1.25) +
  scale_y_continuous(limits = c(0, 75)) +
  ylab("Stretch-activated Specific Tension (mN/mm^2)") +
  guides(fill = guide_legend(title = "Fiber Types")) +
  theme(axis.title.y = element_text(size = 18),
        axis.title.x = element_blank(),
        axis.text = element_text(size = 15),
        legend.title = element_text(size = 15),
        legend.text = element_text(size = 15),
        legend.key.size = unit(1, "cm")) +
  scale_fill_manual(breaks = c("I",
                               "IIA",
                               "IIX",
                               "IIB"),
                    values = c("#E69F00",
                               "#56B4E9",
                               "#CC79A7",
                               "#009E73"))


fsaf0_gg <- my_data_means %>%
  filter(Value == "Ratio") %>%
  ggplot(aes(Exp_Con,
             EMM,
             group = fiber_type_num)) +
  geom_bar(aes(fill = fiber_type),
           stat = "identity",
           position = position_dodge()) +
  geom_point(data = my_data_raw,
             aes(x = Exp_Con,
                 y = FsaF0,
                 text = paste("Filename", Filename),
                 shape = Muscle),
             position = position_dodge(width = 0.9)) +
  geom_errorbar(aes(ymin = EMM - SE,
                    ymax = EMM + SE),
                position = position_dodge(width = 0.9),
                width = 0.15,
                size = 1.25) +
  scale_y_continuous(limits = c(0, 35)) +
  ylab("Stretch-to-Calcium-activated Specific Tension (%)") +
  guides(fill = guide_legend(title = "Fiber Types")) +
  theme(axis.title.y = element_text(size = 18),
        axis.title.x = element_blank(),
        axis.text = element_text(size = 15),
        legend.title = element_text(size = 15),
        legend.text = element_text(size = 15),
        legend.key.size = unit(1, "cm")) +
  scale_fill_manual(breaks = c("I",
                               "IIA",
                               "IIX",
                               "IIB"),
                    values = c("#E69F00",
                               "#56B4E9",
                               "#CC79A7",
                               "#009E73"))


fsatotal_gg <- my_data_means %>%
  filter(Value == "FsaTotal") %>%
  ggplot(aes(Exp_Con,
             EMM,
             group = fiber_type_num)) +
  geom_bar(aes(fill = fiber_type),
           stat = "identity",
           position = position_dodge()) +
  geom_point(data = my_data_raw,
             aes(x = Exp_Con,
                 y = Fsa_total,
                 text = paste("Filename", Filename),
                 shape = Muscle),
             position = position_dodge(width = 0.9)) +
  geom_errorbar(aes(ymin = EMM - SE,
                    ymax = EMM + SE),
                position = position_dodge(width = 0.9),
                width = 0.15,
                size = 1.25) +
  scale_y_continuous(limits = c(0, 35)) +
  ylab("Stretch-to-Calcium-activated Specific Tension (%)") +
  guides(fill = guide_legend(title = "Fiber Types")) +
  theme(axis.title.y = element_text(size = 18),
        axis.title.x = element_blank(),
        axis.text = element_text(size = 15),
        legend.title = element_text(size = 15),
        legend.text = element_text(size = 15),
        legend.key.size = unit(1, "cm")) +
  scale_fill_manual(breaks = c("I",
                               "IIA",
                               "IIX",
                               "IIB"),
                    values = c("#E69F00",
                               "#56B4E9",
                               "#CC79A7",
                               "#009E73"))



### t3 -----------------------------------------------------

t3_gg <- my_data_means %>%
  filter(Value == "t3") %>%
  ggplot(aes(Exp_Con,
             EMM,
             group = fiber_type_num)) +
  geom_bar(aes(fill = fiber_type),
           stat = "identity",
           position = position_dodge()) +
  geom_point(data = my_data_raw,
             aes(x = Exp_Con,
                 y = t3,
                 text = paste("Filename", Filename)),
             position = position_dodge(width = 0.9)) +
  geom_errorbar(aes(ymin = EMM - SE,
                    ymax = EMM + SE),
                position = position_dodge(width = 0.9),
                width = 0.15,
                size = 1.25) +
  ylab("t3") +
  guides(fill = guide_legend(title = "Fiber Types")) +
  theme(axis.title.y = element_text(size = 18),
        axis.title.x = element_blank(),
        axis.text = element_text(size = 15),
        legend.title = element_text(size = 15),
        legend.text = element_text(size = 15),
        legend.key.size = unit(1, "cm")) +
  scale_fill_manual(breaks = c("I",
                               "IIA",
                               "IIX",
                               "IIB"),
                    values = c("#E69F00",
                               "#56B4E9",
                               "#CC79A7",
                               "#009E73"))

### FSA vs F0  ---------------------------


```

# Data

## Column {data-width=400, .tabset}

### Raw Data

```{r}
reactable(my_data_raw)
```
### Avereaged Data
```{r}
reactable(my_data_means)
```

# Stretch Activation

## Column {data-width=500, .tabset}

### F0 - Averaged

```{r}
ggplotly(f0_gg)

```

### Fsa - Averaged

```{r}
ggplotly(Fsa_gg)
```

### Fsa/F0 - Averaged

```{r}
ggplotly(FsaF0_gg)
```

### Fsa/(Fsa + F0) - Averaged

```{r}
ggplotly(FsaTotal_gg)
```

# t3
```{r}
ggplotly(t3_gg)
```