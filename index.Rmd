---
title: "Woods Master's Thesis"
output: 
  flexdashboard::flex_dashboard:
    orientation: columns
    vertical_layout: fill
---

```{r setup, include=FALSE}
library(tidyverse)
library(flexdashboard)
library(readxl)
library(tcltk)
library(ggpubr)
library(plotly)
library(reactable)
theme_set(theme_classic())


setwd("C:/Users/Phil/Dropbox/Thesis- Stretch Activation/Data/Woods - Master's Thesis/Project/Tension + AaBbCc")

my_data <- read_excel("SA-Fatigue_Tension+Step+Kinetics_PW_10-20-22.xlsx", 
                      sheet = "NEACSM",
                      skip = 5,
                      na="") %>% 
  filter(Exp_Con_Num %in% c(3,5,6)) %>%
  filter(fiber_type_num %in% (1:4)) %>%
  group_by(Exp_Con, fiber_type, fiber_type_num) %>%
  summarize(n = n(),
            f0_avg = mean(Po_Pre_Step, na.rm=T),
            f0_sd = sd(Po_Pre_Step, na.rm=T),
            f0_se = sd(Po_Pre_Step, na.rm=T)/sqrt(n()),
            fsa_avg = mean(Fsa, na.rm = T),
            fsa_sd = sd(Fsa, na.rm = T),
            fsa_se = sd(Fsa, na.rm = T)/sqrt(n()),
            fsaf0_avg = mean(FsaF0, na.rm = T),
            fsaf0_sd = sd(FsaF0, na.rm = T),
            fsaf0_se = sd(FsaF0, na.rm = T)/sqrt(n()),
            fsatotal_avg = mean(Fsa_total, na.rm = T),
            fsatotal_sd = sd(Fsa_total, na.rm = T),
            fsatotal_se = sd(Fsa_total, na.rm = T)/sqrt(n())
  )

my_data_filt <- read_excel("SA-Fatigue_Tension+Step+Kinetics_PW_10-20-22.xlsx", 
                      sheet = "NEACSM",
                      skip = 5,
                      na="") %>% 
  filter(Exp_Con_Num %in% c(3,5,6)) %>% 
  filter(fiber_type_num %in% c(1:4)) %>% 
  group_by(Exp_Con, fiber_type)


(f0_gg <- my_data %>% 
    ggplot(aes(Exp_Con, 
               f0_avg, 
               group = fiber_type_num)) +
    geom_bar(aes(fill = fiber_type),
             stat = "identity",
             position = position_dodge())+
    geom_point(data = my_data_filt,
               aes(x = Exp_Con,
                   y = Po_Pre_Step),
               position = position_dodge(width = 0.9)) +
    geom_errorbar(aes(ymin=f0_avg-f0_se,
                      ymax=f0_avg+f0_se),
                  position = position_dodge(width = 0.9),
                  width=0.15,
                  size = 1.25) +
    scale_y_continuous(limits = c(0,350)) +
    ylab(expression(atop("Calcium-activated",
                         paste("Specific Tension (mN/mm^2)"))))+
    guides(fill=guide_legend(title = "Fiber Types")) + 
    theme(axis.title.y = element_text(size = 30),
          axis.title.x = element_blank(),
          axis.text = element_text(size = 25),
          legend.title = element_text(size = 25),
          legend.text = element_text(size = 20),
          legend.key.size = unit(1,"cm")) +
    scale_fill_manual(breaks = c("I",
                                 "IIA",
                                 "IIX",
                                 "IIB"),
                      values = c("#E69F00",
                                 "#56B4E9",
                                 "#CC79A7",
                                 "#009E73")) +
    scale_x_discrete(breaks = c("Active",
                                "Fat_4.5",
                                "Fat_5.1"),
                     labels = c("Active",
                                expression(atop("High Calcium",
                                                paste("Fatigue"))),
                                expression(atop("Low Calcium",
                                                paste("Fatigue")))))
)

(Fsa_gg <- my_data %>% 
    ggplot(aes(Exp_Con, 
               fsa_avg, 
               group = fiber_type_num)) +
    geom_bar(aes(fill = fiber_type),
             stat = "identity",
             position = position_dodge())+
    geom_point(data = my_data_filt,
               aes(x = Exp_Con,
                   y = Fsa),
               position = position_dodge(width = 0.9)) +
    geom_errorbar(aes(ymin=fsa_avg-fsa_se,
                      ymax=fsa_avg+fsa_se),
                  position = position_dodge(width = 0.9),
                  width=0.15,
                  size = 1.25) +
    scale_y_continuous(limits = c(0,75)) +
    ylab(expression(atop("Stretch-activated",
                         paste("Specific Tension (mN/mm^2)"))))+
    guides(fill=guide_legend(title = "Fiber Types")) + 
    theme(axis.title.y = element_text(size = 30),
          axis.title.x = element_blank(),
          axis.text = element_text(size = 25),
          legend.title = element_text(size = 25),
          legend.text = element_text(size = 20),
          legend.key.size = unit(1,"cm")) +
    scale_fill_manual(breaks = c("I",
                                 "IIA",
                                 "IIX",
                                 "IIB"),
                      values = c("#E69F00",
                                 "#56B4E9",
                                 "#CC79A7",
                                 "#009E73")) +
    scale_x_discrete(breaks = c("Active",
                                "Fat_4.5",
                                "Fat_5.1"),
                     labels = c("Active",
                                expression(atop("High Calcium",
                                                paste("Fatigue"))),
                                expression(atop("Low Calcium",
                                                paste("Fatigue")))))
)

(FsaF0_gg <- my_data %>% 
    ggplot(aes(Exp_Con, 
               fsatotal_avg, 
               group = fiber_type_num)) +
    geom_bar(aes(fill = fiber_type),
             stat = "identity",
             position = position_dodge())+
    geom_point(data = my_data_filt,
               aes(x = Exp_Con,
                   y = Fsa_total),
               position = position_dodge(width = 0.9)) +
    geom_errorbar(aes(ymin=fsatotal_avg-fsatotal_se,
                      ymax=fsatotal_avg+fsatotal_se),
                  position = position_dodge(width = 0.9),
                  width=0.15,
                  size = 1.25) +
    scale_y_continuous(limits = c(0,35)) +
    ylab(expression(atop("Stretch-to-Calcium-activated",
                         paste("Specific Tension (%)"))))+
    guides(fill=guide_legend(title = "Fiber Types")) + 
    theme(axis.title.y = element_text(size = 30),
          axis.title.x = element_blank(),
          axis.text = element_text(size = 25),
          legend.title = element_text(size = 25),
          legend.text = element_text(size = 20),
          legend.key.size = unit(1,"cm")) +
    scale_fill_manual(breaks = c("I",
                                 "IIA",
                                 "IIX",
                                 "IIB"),
                      values = c("#E69F00",
                                 "#56B4E9",
                                 "#CC79A7",
                                 "#009E73")) +
    scale_x_discrete(breaks = c("Active",
                                "Fat_4.5",
                                "Fat_5.1"),
                     labels = c("Active",
                                expression(atop("High Calcium",
                                                paste("Fatigue"))),
                                expression(atop("Low Calcium",
                                                paste("Fatigue")))))
)
```

# Data

## Column {data-width=400, .tabset}

### Raw Data

```{r}
reactable(my_data_filt)

```
### Avereaged Data
```{r}
reactable(my_data)
```

# Stretch Activation

## Column {data-width=500, .tabset}

### F0 - Averaged

```{r}
ggplotly(f0_gg)

```

### Fsa - Averaged

```{r}
ggplotly(Fsa_gg)
```

### Fsa/F0 - Averaged

```{r}
ggplotly(FsaF0_gg)
```

# Rate Fittings - 3 Exponential 

## Column {data-width=500, .tabset}

### a2 - Averaged

```{r, fig.height=5, fig.width=5}
ggplotly(a2_gg)
```

### a3 - Averaged

```{r}
ggplotly(a3_gg)
```

### a4 - Averaged

```{r}
ggplotly(a4_gg)
```

## Column {data-width=500, .tabset}

### r2

```{r, fig.height=5, fig.width=5}
ggplotly(r2)
```

### r3

```{r}
ggplotly(r3)
```

### r4

```{r}
ggplotly(r4)
```


# Rates

## Column {data-width=500, .tabset}

### r2 - Averaged

```{r, fig.height=5, fig.width=5}
ggplotly(r2_gg)
```

### r3 - Averaged

```{r}
ggplotly(r3_gg)
```

### r4 - Averaged

```{r}
ggplotly(r4_gg)
```

## Column {data-width=500, .tabset}

### r2 - Individual Fibers

```{r, fig.height=5, fig.width=5}
ggplotly(r2_plot_fibers)
```

### r3 - Individual Fibers

```{r}
ggplotly(r3_plot_fibers)
```

### r4 - Individual Fibers

```{r}
ggplotly(r4_plot_fibers)
```
